<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>작업별 보호구 착용 옷입히기 게임</title>
  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; }
    .page { display: none; padding: 20px; }
    .active { display: block; }
    .center { text-align: center; }
    .rounded-border { border: 1px solid black; border-radius: 10px; }
    /* 공통 스타일 */
    .button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
    /* 페이지3~7 근로자 컨테이너 */
    #worker-container { position: relative; width: 100%; text-align: center; }
    #worker-container img { width: 100%; height: auto; display: block; margin: 0 auto; }
    /* 보호구 그리드 */
    #gear-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
    .gear-item img { width: 80%; display: block; cursor: pointer; margin: 0 auto; }
    /* 에러 메시지 */
    #error-message { color: red; text-align: center; margin-top: 10px; }
    /* 수료증 박스 */
    #certificate-box { border: 2px solid #000; padding: 20px; margin: 20px 0; text-align: left; }
  </style>
</head>
<body>
  <!-- 페이지1: 시작 -->
  <div id="page1" class="page active">
    <div class="center">
      <h1>작업별 보호구 착용 교육</h1>
      <img src="https://i.imgur.com/Tu6mJ5J.png" alt="메인 이미지">
      <br>
      <button class="button" onclick="goPage(2)">교육 시작하기</button>
    </div>
  </div>

  <!-- 페이지2: 정보 입력 -->
  <div id="page2" class="page">
    <h2>교육 정보 입력</h2>
    <label>현장명:</label><br>
    <input type="text" id="siteName" placeholder="현장명 입력"><br><br>
    <label>근로자 이름:</label><br>
    <input type="text" id="workerName" placeholder="이름 입력"><br><br>
    <label>소속:</label><br>
    <input type="text" id="workerAffiliation" placeholder="소속 입력"><br><br>
    <button class="button" onclick="goPage(3)">다음</button>
  </div>

  <!-- 페이지3: 공통작업 -->
  <div id="page3" class="page">
    <h2>일반작업 시 고소작업 시 필수착용 개인보호구</h2>
    <div id="worker-container" class="center"></div>
    <div id="gear-grid"></div>
    <div id="error-message"></div>
    <div class="center"><button class="button" onclick="goPage(4)" id="btn3" disabled>다음</button></div>
  </div>

  <!-- 페이지4: 용접작업 -->
  <div id="page4" class="page">
    <h2>용접작업 시 필수착용 개인보호구</h2>
    <div id="worker-container" class="center"></div>
    <div id="gear-grid"></div>
    <div id="error-message"></div>
    <div class="center"><button class="button" onclick="goPage(5)" id="btn4" disabled>다음</button></div>
  </div>

  <!-- 페이지5: 정전작업1 -->
  <div id="page5" class="page">
    <h2>정전작업 시 필수착용 개인보호구</h2>
    <div id="worker-container" class="center"></div>
    <div id="gear-grid"></div>
    <div id="error-message"></div>
    <div class="center"><button class="button" onclick="goPage(6)" id="btn5" disabled>다음</button></div>
  </div>

  <!-- 페이지6: 정전작업2 -->
  <div id="page6" class="page">
    <h2>정전작업 시 필수착용 개인보호구</h2>
    <div id="worker-container" class="center"></div>
    <div id="gear-grid"></div>
    <div id="error-message"></div>
    <div class="center"><button class="button" onclick="goPage(7)" id="btn6" disabled>다음</button></div>
  </div>

  <!-- 페이지7: 일반작업 공통착용 -->
  <div id="page7" class="page">
    <h2>일반작업 공통착용 개인보호구</h2>
    <div id="worker-container" class="center"></div>
    <div id="gear-grid"></div>
    <div id="error-message"></div>
    <div class="center"><button class="button" onclick="goPage(8)" id="btn7" disabled>다음</button></div>
  </div>

  <!-- 페이지8: 수료증 -->
  <div id="page8" class="page">
    <h2>수료증</h2>
    <div id="certificate-box">
      <p>현장명: <span id="cert-site"></span></p>
      <p>근로자 이름: <span id="cert-worker"></span></p>
      <p>소속: <span id="cert-affiliation"></span></p>
      <p>보호구 교육을 모두 수료하셨습니다.</p>
    </div>
    <div class="center">
      <button class="button" onclick="saveCert()">저장하기</button>
      <button class="button" onclick="goPage(1)">홈으로</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let currentPage = 1;
    const gearData = {
      3: {
        workerImg: 'https://i.imgur.com/Ifwwzoz.png',
        items: [
          {id:1, thumb:'https://i.imgur.com/yvsCOBF.png', overlay:'https://i.imgur.com/yTJe79p.png', correct:true, z:3},
          {id:2, thumb:'https://i.imgur.com/8gsL65v.png', overlay:'https://i.imgur.com/zBCjthf.png', correct:true, z:4},
          {id:3, thumb:'https://i.imgur.com/nvoxlp7.png', overlay:'https://i.imgur.com/VfJMtc3.png', correct:true, z:5},
          {id:4, thumb:'https://i.imgur.com/m1GZRHc.png', overlay:'https://i.imgur.com/Cphm4b5.png', correct:true, z:2},
          {id:5, thumb:'https://i.imgur.com/d7Plzcn.png', overlay:'https://i.imgur.com/5VxjKY6.png', correct:true, z:6},
          {id:6, thumb:'https://i.imgur.com/Ui2tbVv.png', overlay:'', correct:false, z:1}
        ]
      },
      4: {
        workerImg: 'https://imgur.com/WlQOZoc',
        items: [
          {id:1, thumb:'https://imgur.com/nvoxlp7', overlay:'', correct:false, z:1},
          {id:2, thumb:'https://imgur.com/oU1hjTk', overlay:'https://imgur.com/cPHvWTb', correct:true, z:3},
          {id:3, thumb:'https://imgur.com/Ui2tbVv', overlay:'https://imgur.com/S77YoN3', correct:true, z:4},
          {id:4, thumb:'https://imgur.com/Cbcyknu', overlay:'https://imgur.com/v5kUQPg', correct:true, z:2},
          {id:5, thumb:'https://imgur.com/nvoxlp7', overlay:'', correct:false, z:5},
          {id:6, thumb:'https://imgur.com/fdH4wzC', overlay:'', correct:false, z:6}
        ]
      },
      5: {
        workerImg: 'https://imgur.com/WlQOZoc',
        items: [
          {id:1, thumb:'https://imgur.com/NnWSEdz', overlay:'https://imgur.com/ImnVVaf', correct:true},
          {id:2, thumb:'https://imgur.com/NdbXUPl', overlay:'https://imgur.com/IMelM9Q', correct:true},
          {id:3, thumb:'https://imgur.com/Z5ojhhi', overlay:'https://imgur.com/3KX2VD4', correct:true},
          {id:4, thumb:'https://imgur.com/Ui2tbVv', overlay:'', correct:false},
          {id:5, thumb:'https://imgur.com/Cbcyknu', overlay:'', correct:false},
          {id:6, thumb:'https://imgur.com/fdH4wzC', overlay:'', correct:false}
        ]
      },
      6: {
        workerImg: 'https://i.imgur.com/Ifwwzoz.png',
        items: [
          {id:1, thumb:'https://imgur.com/fdH4wzC', overlay:'https://imgur.com/fdH4wzC', correct:true, z:1},
          {id:2, thumb:'https://imgur.com/yvsCOBF.png', overlay:'https://imgur.com/yTJe79p.png', correct:true, z:2},
          {id:3, thumb:'https://imgur.com/F1PF0tE', overlay:'https://imgur.com/Gctejg5', correct:true, z:3},
          {id:4, thumb:'https://imgur.com/n6iJRus', overlay:'https://imgur.com/oAQe9gI', correct:true, z:4},
          {id:5, thumb:'https://imgur.com/d7Plzcn.png', overlay:'https://imgur.com/5VxjKY6.png', correct:true},
          {id:6, thumb:'https://imgur.com/NdbXUPl', overlay:'', correct:false}
        ]
      },
      7: {
        workerImg: 'https://imgur.com/Ifwwzoz.png',
        items: [
          {id:1, thumb:'https://imgur.com/yvsCOBF.png', overlay:'https://imgur.com/yTJe79p.png', correct:true},
          {id:2, thumb:'https://imgur.com/nvoxlp7', overlay:'https://imgur.com/VfJMtc3.png', correct:true},
          {id:3, thumb:'https://imgur.com/d7Plzcn', overlay:'https://imgur.com/5VxjKY6.png', correct:true},
          {id:4, thumb:'https://imgur.com/m1GZRHc', overlay:'https://imgur.com/Cphm4b5.png', correct:true},
          {id:5, thumb:'https://imgur.com/Cbcyknu', overlay:'', correct:false},
          {id:6, thumb:'https://imgur.com/Ui2tbVv', overlay:'', correct:false}
        ]
      }
    };

    function goPage(num) {
      // 페이지 전환
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById('page'+num).classList.add('active');
      currentPage = num;
      if(num>=3 && num<=7) initGearPage(num);
      if(num===8) showCertificate();
    }

    function initGearPage(pg) {
      const data = gearData[pg];
      const container = document.getElementById('worker-container');
      container.innerHTML = '<img src="'+data.workerImg+'" class="rounded-border" alt="근로자 이미지">';
      const grid = document.getElementById('gear-grid'); grid.innerHTML='';
      document.getElementById('error-message').innerText='';
      const btn = document.getElementById('btn'+pg);
      btn.disabled = true;
      data.items.forEach(item=>{
        item.applied=false;
        const div=document.createElement('div'); div.className='gear-item';
        const img=document.createElement('img');
        img.src=item.thumb; img.className='rounded-border'; img.dataset.id=item.id;
        img.onclick=()=>toggleItem(pg,item,img);
        div.appendChild(img); grid.appendChild(div);
      });
    }

    function toggleItem(pg,item,imgElem) {
      const data=gearData[pg];
      if(!item.correct) {
        document.getElementById('error-message').innerText='올바르지 않은 보호구가 아닙니다.';
        setTimeout(()=>document.getElementById('error-message').innerText='',2000);
        return;
      }
      item.applied=!item.applied;
      imgElem.style.opacity=item.applied?0.5:1;
      if(item.applied) addOverlay(pg,item);
      else removeOverlay(item);
      checkAll(pg);
    }

    function addOverlay(pg,item) {
      const container=document.getElementById('worker-container');
      const overlay=document.createElement('img');
      overlay.src=item.overlay; overlay.className='overlay'; overlay.dataset.id=item.id;
      overlay.style.position='absolute'; overlay.style.top='0'; overlay.style.left='0';
      overlay.style.width='100%'; overlay.style.height='100%';
      if(item.z) overlay.style.zIndex=item.z;
      container.appendChild(overlay);
    }

    function removeOverlay(item) {
      const container=document.getElementById('worker-container');
      const ov=container.querySelector('img.overlay[data-id="'+item.id+'"]');
      if(ov) container.removeChild(ov);
    }

    function checkAll(pg) {
      const all=gearData[pg].items.filter(i=>i.correct).every(i=>i.applied);
      document.getElementById('btn'+pg).disabled=!all;
    }

    function showCertificate() {
      document.getElementById('cert-site').innerText=document.getElementById('siteName').value;
      document.getElementById('cert-worker').innerText=document.getElementById('workerName').value;
      document.getElementById('cert-affiliation').innerText=document.getElementById('workerAffiliation').value;
    }

    function saveCert() {
      html2canvas(document.getElementById('certificate-box')).then(canvas=>{
        const link=document.createElement('a'); link.download='certificate.png';
        link.href=canvas.toDataURL(); link.click();
      });
    }
  </script>
</body>
</html>
