<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>작업별 보호구 착용 옷입히기 게임</title>
  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; }
    .page { display: none; padding: 20px; }
    .active { display: block; }
    .center { text-align: center; }
    .rounded-border {
      border: 1px solid black;
      border-radius: 10px;
    }
    #page1 img { max-width: 100%; height: auto; }
    #page2 { text-align: left; }
    .blink { color: red; }
    .worker-container {
      position: relative;
      width: 100%;
      text-align: center;
    }
    .worker-image {
      width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    .gear-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .gear-item img {
      width: 80%;
      display: block;
      cursor: pointer;
      margin: 0 auto;
    }
    .score-display {
      position: fixed;
      bottom: 60px;
      right: 10px;
      background: #f0f0f0;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-weight: bold;
      z-index: 1000;
      min-width: 100px;
      text-align: center;
    }
    .chances-display {
      position: fixed;
      bottom: 10px;
      right: 10px;
      padding: 10px;
      border-radius: 5px;
      font-weight: bold;
      z-index: 1000;
      min-width: 100px;
      text-align: center;
    }
    .cycle-1 { background: #e8f5e8 !important; border: 2px solid #4caf50 !important; color: #2e7d32 !important; }
    .cycle-2 { background: #fff3e0 !important; border: 2px solid #ff9800 !important; color: #e65100 !important; }
    .cycle-3-plus { background: #ffebee !important; border: 2px solid #f44336 !important; color: #d32f2f !important; }
    #certificate-box {
      border: 2px solid #000;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    .button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .ranking-table {
      margin-top: 30px;
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }
    .ranking-table th, .ranking-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    .ranking-table th { background-color: #f2f2f2; font-weight: bold; }
    .ranking-table tr:nth-child(even) { background-color: #f9f9f9; }
    .loading { text-align: center; color: #666; font-style: italic; }
    .button-group { margin-top: 20px; }
    .restart-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }
    .restart-button:hover { background-color: #45a049; }
  </style>
</head>
<body>
  <div id="score-display" class="score-display" style="display:none;">
    점수: <span id="current-score">0</span>
  </div>
  <div id="chances-display" class="chances-display" style="display:none;">
    클릭 기회: <span id="remaining-chances">∞</span>
  </div>

  <!-- 페이지1 -->
  <div id="page1" class="page active">
    <div class="center">
      <h1>작업별 보호구 착용 교육</h1>
      <img src="https://i.imgur.com/Tu6mJ5J.png" alt="메인 이미지">
      <br>
      <button class="button" id="startButton">교육 시작하기</button>
    </div>
  </div>

  <!-- 페이지2 -->
  <div id="page2" class="page">
    <h2>교육 정보 입력</h2>
    <label>현장명:</label><br>
    <input type="text" id="siteName" placeholder="현장명 입력"><br><br>
    <label>근로자 이름:</label><br>
    <input type="text" id="workerName" placeholder="이름 입력"><br><br>
    <label>소속:</label><br>
    <input type="text" id="workerAffiliation" placeholder="소속 입력"><br><br>
    <div class="blink">작업 상황에 따른 보호구 착용 기준을 옷입히기 게임 방식으로 학습합니다. 근로자 캐릭터 하단의 보호구를 클릭하여 올바른 보호구를 착용시켜주세요.</div>
    <br>
    <button class="button" id="toPage3">다음</button>
  </div>

  <!-- 페이지3 -->
  <div id="page3" class="page">
    <h2>고소작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/Ifwwzoz.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-3"></div>
    <div id="error-message-3" style="color:red;text-align:center;margin-top:10px;"></div>
    <div class="center button-group" id="button-container-3">
      <button class="button" id="next-button-3" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지4 -->
  <div id="page4" class="page">
    <h2>용접작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/WlQOZoc.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-4"></div>
    <div id="error-message-4" style="color:red;text-align:center;margin-top:10px;"></div>
    <div class="center button-group" id="button-container-4">
      <button class="button" id="next-button-4" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지5 -->
  <div id="page5" class="page">
    <h2>정전작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/WlQOZoc.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-5"></div>
    <div id="error-message-5" style="color:red;text-align:center;margin-top:10px;"></div>
    <div class="center button-group" id="button-container-5">
      <button class="button" id="next-button-5" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지6 -->
  <div id="page6" class="page">
    <h2>도장작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/Ifwwzoz.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-6"></div>
    <div id="error-message-6" style="color:red;text-align:center;margin-top:10px;"></div>
    <div class="center button-group" id="button-container-6">
      <button class="button" id="next-button-6" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지7 -->
  <div id="page7" class="page">
    <h2>일반작업 공통착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/Ifwwzoz.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-7"></div>
    <div id="error-message-7" style="color:red;text-align:center;margin-top:10px;"></div>
    <div class="center button-group" id="button-container-7">
      <button class="button" id="next-button-7" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지8 -->
  <div id="page8" class="page">
    <h2>수료증</h2>
    <div id="certificate-box">
      <p id="cert-siteName"></p>
      <p id="cert-workerName"></p>
      <p id="cert-workerAffiliation"></p>
      <p>보호구 교육을 모두 수료하셨습니다.</p>
    </div>
    <div style="text-align:center;">
      <button class="button" id="saveCert">저장하기</button>
      <button class="button" id="homeButton">홈으로</button>
      <h3>🏆 이번 주 랭킹</h3>
      <div id="ranking-loading" class="loading">랭킹을 불러오는 중...</div>
      <table id="ranking-table" class="ranking-table" style="display:none;">
        <thead>
          <tr><th>순위</th><th>근로자 이름</th><th>현장명</th><th>소속</th><th>점수</th></tr>
        </thead>
        <tbody id="ranking-body"></tbody>
      </table>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Firebase 초기화
    const firebaseConfig = { /* 여기에 실제 설정 삽입 */ };
    try { firebase.initializeApp(firebaseConfig); } catch(e){}
    let db = firebase.firestore();

    // 3~7 페이지별 보호구 데이터
    const pageGearData = {
      3: [
        { id:1, thumbnail:'https://i.imgur.com/yvsCOBF.png', overlay:'https://i.imgur.com/yTJe79p.png', correct:true, zIndex:1 },
        { id:2, thumbnail:'https://i.imgur.com/8gsL65v.png', overlay:'https://i.imgur.com/zBCjthf.png', correct:true, zIndex:2 },
        { id:3, thumbnail:'https://i.imgur.com/nvoxlp7.png', overlay:'https://i.imgur.com/VfJMtc3.png', correct:true, zIndex:3 },
        { id:4, thumbnail:'https://i.imgur.com/m1GZRHc.png', overlay:'https://i.imgur.com/Cphm4b5.png', correct:true, zIndex:4 },
        { id:5, thumbnail:'https://i.imgur.com/d7Plzcn.png', overlay:'https://i.imgur.com/5VxjKY6.png', correct:true, zIndex:5 },
        { id:6, thumbnail:'https://i.imgur.com/Ui2tbVv.png', overlay:'', correct:false, zIndex:6 }
      ],
      4: [
        { id:1, thumbnail:'https://imgur.com/n6iJRus.png', overlay:'', correct:false, zIndex:1 },
        { id:2, thumbnail:'https://i.imgur.com/oU1hjTk.png', overlay:'https://i.imgur.com/cPHvWTb.png', correct:true, zIndex:2 },
        { id:3, thumbnail:'https://i.imgur.com/Ui2tbVv.png', overlay:'https://i.imgur.com/S77YoN3.png', correct:true, zIndex:4 },
        { id:4, thumbnail:'https://i.imgur.com/Cbcyknu.png', overlay:'https://i.imgur.com/v5kUQPg.png', correct:true, zIndex:3 },
        { id:5, thumbnail:'https://i.imgur.com/nvoxlp7.png', overlay:'', correct:false, zIndex:5 },
        { id:6, thumbnail:'https://i.imgur.com/fdH4wzC.png', overlay:'', correct:false, zIndex:6 }
      ],
      5: [
        { id:1, thumbnail:'https://i.imgur.com/NnWSEdz.png', overlay:'https://i.imgur.com/ImnVVaf.png', correct:true, zIndex:1 },
        { id:2, thumbnail:'https://i.imgur.com/NdbXUPl.png', overlay:'https://i.imgur.com/IMelM9Q.png', correct:true, zIndex:2 },
        { id:3, thumbnail:'https://i.imgur.com/Z5ojhhi.png', overlay:'https://i.imgur.com/3KX2VD4.png', correct:true, zIndex:3 },
        { id:4, thumbnail:'https://i.imgur.com/Ui2tbVv.png', overlay:'', correct:false, zIndex:4 },
        { id:5, thumbnail:'https://i.imgur.com/Cbcyknu.png', overlay:'', correct:false, zIndex:5 },
        { id:6, thumbnail:'https://i.imgur.com/fdH4wzC.png', overlay:'', correct:false, zIndex:6 }
      ],
      6: [
        { id:1, thumbnail:'https://i.imgur.com/fdH4wzC.png', overlay:'https://i.imgur.com/fdH4wzC.png', correct:true, zIndex:1 },
        { id:2, thumbnail:'https://i.imgur.com/yvsCOBF.png', overlay:'https://i.imgur.com/yTJe79p.png', correct:true, zIndex:2 },
        { id:3, thumbnail:'https://i.imgur.com/F1PF0tE.png', overlay:'https://i.imgur.com/Gctejg5.png', correct:true, zIndex:3 },
        { id:4, thumbnail:'https://i.imgur.com/n6iJRus.png', overlay:'https://i.imgur.com/oAQe9gI.png', correct:true, zIndex:4 },
        { id:5, thumbnail:'https://i.imgur.com/d7Plzcn.png', overlay:'https://i.imgur.com/5VxjKY6.png', correct:true, zIndex:5 },
        { id:6, thumbnail:'https://i.imgur.com/NdbXUPl.png', overlay:'', correct:false, zIndex:6 }
      ],
      7: [
        { id:1, thumbnail:'https://i.imgur.com/yvsCOBF.png', overlay:'https://i.imgur.com/yTJe79p.png', correct:true, zIndex:1 },
        { id:2, thumbnail:'https://i.imgur.com/nvoxlp7.png', overlay:'https://i.imgur.com/VfJMtc3.png', correct:true, zIndex:2 },
        { id:3, thumbnail:'https://i.imgur.com/d7Plzcn.png', overlay:'https://i.imgur.com/5VxjKY6.png', correct:true, zIndex:3 },
        { id:4, thumbnail:'https://i.imgur.com/m1GZRHc.png', overlay:'https://i.imgur.com/Cphm4b5.png', correct:true, zIndex:4 },
        { id:5, thumbnail:'https://i.imgur.com/Cbcyknu.png', overlay:'', correct:false, zIndex:5 },
        { id:6, thumbnail:'https://i.imgur.com/Ui2tbVv.png', overlay:'', correct:false, zIndex:6 }
      ]
    };

    // 이하 스크립트 로직은 이전과 동일하게 유지
    // ...
  </script>
</body>
</html>
