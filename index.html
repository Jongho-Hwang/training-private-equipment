<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>작업별 보호구 착용 옷입히기 게임</title>
  <style>
    /* === 기본 세팅 === */
    *{box-sizing:border-box}
    body{margin:0;padding:0;font-family:sans-serif}

    /* 페이지 기본·활성 표시 */
    .page{display:none;width:100%;padding:20px}
    .page.active{display:block}
    .flex-page.active{display:flex;justify-content:center;align-items:center;min-height:100vh}

    /* 공통 카드 */
    .card{
      background:#fff;border-radius:20px;
      box-shadow:0 15px 25px rgba(0,0,0,.1);
      padding:40px;
      width:100%;max-width:600px;margin:0 auto
    }

    /* 배경 */
    #page1{background:linear-gradient(135deg,#7b5dff 0%,#4a8dff 100%)}
    #page2{background:radial-gradient(circle at top left,#f3f3f5 0%,#e9e9eb 100%)}
    #page8{background:linear-gradient(135deg,#b6f0e8 0%,#d3ecf6 50%,#ffd6e6 100%)}

    /* 버튼 */
    .button{
      padding:12px 24px;margin:10px;font-size:16px;
      cursor:pointer;color:#fff;border:none;border-radius:8px;
      background:linear-gradient(135deg,#007bff 0%,#0063ff 100%);
      box-shadow:0 4px 12px rgba(0,0,0,.15);
      transition:transform .1s
    }
    .button:hover{transform:translateY(-2px)}
    .restart-button{
      background:linear-gradient(135deg,#6a63ff 0%,#4e45d5 100%);
      color:#fff;border:none;padding:10px 20px;margin:10px;font-size:16px;
      cursor:pointer;border-radius:8px;transition:transform .1s}
    .restart-button:hover{transform:translateY(-2px)}

    /* 둥근 테두리 */
    .rounded-border{border:1px solid #000;border-radius:10px}

    /* ===== 페이지 1 ===== */
    #page1 .card{display:flex;flex-direction:column;align-items:center;text-align:center}
    #page1 h1{margin:0 0 24px 0;word-break:keep-all}  /* 좌·우 여백 균형 */

    /* ===== 페이지 2 ===== */
    #page2 .card{text-align:left}
    #page2 .card h2{text-align:center;margin-top:0}
    .form-group{margin-bottom:20px}
    .form-group label{display:block;margin-bottom:6px;font-weight:600}
    .form-group input{
      width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;
      font-size:16px
    }
    .blink{color:red;padding:16px;border:1px solid #ffb6b6;background:#ffecec;border-radius:6px}

    /* ===== 페이지 3~7 ===== */
    .worker-container{position:relative;width:100%;text-align:center}
    .worker-image{width:100%;height:auto;display:block;margin:0 auto}
    .gear-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:20px}
    .gear-item img{width:80%;display:block;cursor:pointer;margin:0 auto}

    /* 점수·기회 표시 */
    .score-display,.chances-display{
      position:fixed;right:10px;z-index:1000;min-width:100px;
      padding:10px;border-radius:5px;font-weight:bold;text-align:center}
    .score-display{bottom:60px;background:#f0f0f0;border:1px solid #ccc}
    .chances-display{bottom:10px}
    .cycle-1{background:#e8f5e8!important;border:2px solid #4caf50!important;color:#2e7d32!important}
    .cycle-2{background:#fff3e0!important;border:2px solid #ff9800!important;color:#e65100!important}
    .cycle-3-plus{background:#ffebee!important;border:2px solid #f44336!important;color:#d32f2f!important}

    /* ===== 페이지 8 ===== */
    #certificate-box{
      border:2px solid #000;padding:20px;margin:20px 0;text-align:center;
      border-radius:12px
    }
    .ranking-table{margin:30px auto 0;border-collapse:collapse;width:100%;max-width:600px}
    .ranking-table th,.ranking-table td{border:1px solid #ddd;padding:8px;text-align:center}
    .ranking-table th{background:#f2f2f2;font-weight:700}
    .ranking-table tr:nth-child(even){background:#f9f9f9}
    .loading{text-align:center;color:#666;font-style:italic}
  </style>
</head>
<body>
  <!-- 점수 / 기회 -->
  <div id="score-display" class="score-display" style="display:none">점수: <span id="current-score">0</span></div>
  <div id="chances-display" class="chances-display" style="display:none">클릭 기회: <span id="remaining-chances">∞</span></div>

  <!-- 페이지 1 -->
  <div id="page1" class="page flex-page active">
    <div class="card">
      <h1>작업별 보호구 착용 교육</h1>
      <img src="https://i.imgur.com/Tu6mJ5J.png" alt="메인 이미지">
      <button class="button" id="startButton">교육 시작하기</button>
    </div>
  </div>

  <!-- 페이지 2 -->
  <div id="page2" class="page flex-page">
    <div class="card">
      <h2 class="center">기본 정보 입력</h2>
      <div class="form-group">
        <label for="siteName">현장명</label>
        <input id="siteName" placeholder="현장명 입력">
      </div>
      <div class="form-group">
        <label for="workerName">근로자 이름</label>
        <input id="workerName" placeholder="이름 입력">
      </div>
      <div class="form-group">
        <label for="workerAffiliation">소속</label>
        <input id="workerAffiliation" placeholder="소속 입력">
      </div>
      <div class="blink">
        작업 상황에 따른 보호구 착용 기준을 옷입히기 게임 방식으로 학습합니다.<br>
        근로자 캐릭터 하단의 보호구를 클릭하여 올바른 보호구를 착용시켜주세요.
      </div>
      <button class="button" id="toPage3" style="width:100%">다음</button>
    </div>
  </div>

  <!-- 페이지 3 -->
  <div id="page3" class="page">
    <h2>고소작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/Ifwwzoz.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-3"></div>
    <div id="error-message-3" style="color:red;text-align:center;margin-top:10px"></div>
    <div class="center button-group" id="button-container-3">
      <button class="button" id="next-button-3" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지 4 -->
  <div id="page4" class="page">
    <h2>용접작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/WlQOZoc.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-4"></div>
    <div id="error-message-4" style="color:red;text-align:center;margin-top:10px"></div>
    <div class="center button-group" id="button-container-4">
      <button class="button" id="next-button-4" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지 5 -->
  <div id="page5" class="page">
    <h2>정전작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/WlQOZoc.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-5"></div>
    <div id="error-message-5" style="color:red;text-align:center;margin-top:10px"></div>
    <div class="center button-group" id="button-container-5">
      <button class="button" id="next-button-5" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지 6 -->
  <div id="page6" class="page">
    <h2>도장작업시 필수착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/Ifwwzoz.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-6"></div>
    <div id="error-message-6" style="color:red;text-align:center;margin-top:10px"></div>
    <div class="center button-group" id="button-container-6">
      <button class="button" id="next-button-6" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지 7 -->
  <div id="page7" class="page">
    <h2>일반작업 공통착용 개인보호구</h2>
    <div class="worker-container center">
      <img class="worker-image rounded-border" src="https://i.imgur.com/Ifwwzoz.png" alt="근로자 이미지">
    </div>
    <div class="gear-grid" id="gear-grid-7"></div>
    <div id="error-message-7" style="color:red;text-align:center;margin-top:10px"></div>
    <div class="center button-group" id="button-container-7">
      <button class="button" id="next-button-7" disabled>다음</button>
    </div>
  </div>

  <!-- 페이지 8 -->
  <div id="page8" class="page flex-page">
    <div class="card center">
      <div id="certificate-box">
        <h2 style="margin-top:0">수료증</h2>
        <p id="cert-siteName"></p>
        <p id="cert-workerName"></p>
        <p id="cert-workerAffiliation"></p>
        <p>보호구 교육을 모두 수료하셨습니다.</p>
      </div>
      <p id="final-score-display" style="margin-top:20px">최종 점수: <span id="final-score">0</span>점</p>
      <button class="button" id="saveCert">저장하기</button>
      <button class="button" id="homeButton">홈으로</button>
      <h3>🏆 이번 주 랭킹</h3>
      <div id="ranking-loading" class="loading">랭킹을 불러오는 중...</div>
      <table id="ranking-table" class="ranking-table" style="display:none">
        <thead>
          <tr><th>순위</th><th>근로자 이름</th><th>현장명</th><th>소속</th><th>점수</th></tr>
        </thead>
        <tbody id="ranking-body"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- ===== JavaScript : 전체 게임 로직 (누락 없이 포함) ===== -->
  <script>
    /* ------------------------------------------------------------------
       기존 JS 로직 그대로 — 한 글자도 빠짐없이 포함
    ------------------------------------------------------------------ */

    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyDqZFIp_jzaUFiNlZxO3AYI3b8H9zDgyW4",
      authDomain: "training-private-equipment.firebaseapp.com",
      projectId: "training-private-equipment",
      storageBucket: "training-private-equipment.firebasestorage.app",
      messagingSenderId: "428074253490",
      appId: "1:428074253490:web:77d4040f8af17338795dab"
    };

    let db=null;
    try{
      if(firebaseConfig.apiKey!=="your-api-key"){
        firebase.initializeApp(firebaseConfig);
        db=firebase.firestore();
      }
    }catch(e){console.log("Firebase 설정이 없어 로컬 스토리지를 사용합니다.");}

    /* ----- 보호구 데이터 · 상태 변수 등 (동일) ----- */
    const pageGearData={3:[{id:1,thumbnail:"https://i.imgur.com/yvsCOBF.png",overlay:"https://i.imgur.com/yTJe79p.png",correct:!0,applied:!1,zIndex:1},{id:2,thumbnail:"https://i.imgur.com/8gsL65v.png",overlay:"https://i.imgur.com/zBCjthf.png",correct:!0,applied:!1,zIndex:2},{id:3,thumbnail:"https://i.imgur.com/nvoxlp7.png",overlay:"https://i.imgur.com/VfJMtc3.png",correct:!0,applied:!1,zIndex:3},{id:4,thumbnail:"https://i.imgur.com/m1GZRHc.png",overlay:"https://i.imgur.com/Cphm4b5.png",correct:!0,applied:!1,zIndex:4},{id:5,thumbnail:"https://i.imgur.com/d7Plzcn.png",overlay:"https://i.imgur.com/5VxjKY6.png",correct:!0,applied:!1,zIndex:5},{id:6,thumbnail:"https://i.imgur.com/Ui2tbVv.png",overlay:"",correct:!1,applied:!1,zIndex:6}],4:[{id:1,thumbnail:"https://imgur.com/n6iJRus.png",overlay:"",correct:!1,applied:!1,zIndex:1},{id:2,thumbnail:"https://i.imgur.com/oU1hjTk.png",overlay:"https://i.imgur.com/cPHvWTb.png",correct:!0,applied:!1,zIndex:2},{id:3,thumbnail:"https://i.imgur.com/Ui2tbVv.png",overlay:"https://i.imgur.com/S77YoN3.png",correct:!0,applied:!1,zIndex:4},{id:4,thumbnail:"https://i.imgur.com/Cbcyknu.png",overlay:"https://i.imgur.com/v5kUQPg.png",correct:!0,applied:!1,zIndex:3},{id:5,thumbnail:"https://i.imgur.com/nvoxlp7.png",overlay:"",correct:!1,applied:!1,zIndex:5},{id:6,thumbnail:"https://i.imgur.com/fdH4wzC.png",overlay:"",correct:!1,applied:!1,zIndex:6}],5:[{id:1,thumbnail:"https://i.imgur.com/NnWSEdz.png",overlay:"https://i.imgur.com/ImnVVaf.png",correct:!0,applied:!1,zIndex:1},{id:2,thumbnail:"https://i.imgur.com/NdbXUPl.png",overlay:"https://i.imgur.com/IMelM9Q.png",correct:!0,applied:!1,zIndex:2},{id:3,thumbnail:"https://i.imgur.com/Z5ojhhi.png",overlay:"https://i.imgur.com/3KX2VD4.png",correct:!0,applied:!1,zIndex:3},{id:4,thumbnail:"https://i.imgur.com/Ui2tbVv.png",overlay:"",correct:!1,applied:!1,zIndex:4},{id:5,thumbnail:"https://i.imgur.com/Cbcyknu.png",overlay:"",correct:!1,applied:!1,zIndex:5},{id:6,thumbnail:"https://i.imgur.com/fdH4wzC.png",overlay:"",correct:!1,applied:!1,zIndex:6}],6:[{id:1,thumbnail:"https://i.imgur.com/fdH4wzC.png",overlay:"https://i.imgur.com/fdH4wzC.png",correct:!0,applied:!1,zIndex:1},{id:2,thumbnail:"https://i.imgur.com/yvsCOBF.png",overlay:"https://i.imgur.com/yTJe79p.png",correct:!0,applied:!1,zIndex:2},{id:3,thumbnail:"https://i.imgur.com/F1PF0tE.png",overlay:"https://i.imgur.com/Gctejg5.png",correct:!0,applied:!1,zIndex:3},{id:4,thumbnail:"https://i.imgur.com/n6iJRus.png",overlay:"https://i.imgur.com/oAQe9gI.png",correct:!0,applied:!1,zIndex:4},{id:5,thumbnail:"https://i.imgur.com/d7Plzcn.png",overlay:"https://i.imgur.com/5VxjKY6.png",correct:!0,applied:!1,zIndex:5},{id:6,thumbnail:"https://i.imgur.com/NdbXUPl.png",overlay:"",correct:!1,applied:!1,zIndex:6}],7:[{id:1,thumbnail:"https://i.imgur.com/yvsCOBF.png",overlay:"https://i.imgur.com/yTJe79p.png",correct:!0,applied:!1,zIndex:1},{id:2,thumbnail:"https://i.imgur.com/nvoxlp7.png",overlay:"https://i.imgur.com/VfJMtc3.png",correct:!0,applied:!1,zIndex:2},{id:3,thumbnail:"https://i.imgur.com/d7Plzcn.png",overlay:"https://i.imgur.com/5VxjKY6.png",correct:!0,applied:!1,zIndex:3},{id:4,thumbnail:"https://i.imgur.com/m1GZRHc.png",overlay:"https://i.imgur.com/Cphm4b5.png",correct:!0,applied:!1,zIndex:4},{id:5,thumbnail:"https://i.imgur.com/Cbcyknu.png",overlay:"",correct:!1,applied:!1,zIndex:5},{id:6,thumbnail:"https://i.imgur.com/Ui2tbVv.png",overlay:"",correct:!1,applied:!1,zIndex:6}]};

    let currentScore=0,currentSequenceIndex=0,cycleCount=1,remainingChances=Infinity,hasCompletedFirstCycle=!1,isInRandomCycle=!1,gameSequence=[3,4,5,6,7],maxChancesPerCycle={1:Infinity,2:10,default:5};

    /* ---- 점수·기회 표시 함수 (동일) ---- */
    function updateScore(){currentScore++;document.getElementById("current-score").textContent=currentScore}
    function showScore(){document.getElementById("score-display").style.display="block"}
    function hideScore(){document.getElementById("score-display").style.display="none"}
    function updateChances(){const e=document.getElementById("remaining-chances"),t=document.getElementById("chances-display");t.classList.remove("cycle-1","cycle-2","cycle-3-plus"),remainingChances===Infinity?(e.textContent="∞",t.classList.add("cycle-1")):2===cycleCount?(e.textContent=Math.max(0,remainingChances),t.classList.add("cycle-2")):(e.textContent=Math.max(0,remainingChances),t.classList.add("cycle-3-plus"))}
    function showChances(){document.getElementById("chances-display").style.display="block",updateChances()}
    function hideChances(){document.getElementById("chances-display").style.display="none"}
    function decreaseChances(){if(remainingChances!==Infinity&&(remainingChances--,updateChances(),remainingChances<0))return setTimeout(()=>{alert(`💀모든 보호구를 착용하지 못했습니다💀\n현재 점수: ${currentScore}점\n게임이 종료됩니다.`),goToPage8()},500),!0;return!1}
    function setChancesForCycle(){remainingChances=1===cycleCount?Infinity:2===cycleCount?maxChancesPerCycle[2]:maxChancesPerCycle.default,updateChances()}

    /* ---- 페이지 이동 ---- */
    document.getElementById("startButton").addEventListener("click",()=>showPage("page2"));
    document.getElementById("toPage3").addEventListener("click",function(){
      if(!document.getElementById("siteName").value.trim()||!document.getElementById("workerName").value.trim()||!document.getElementById("workerAffiliation").value.trim())return alert("현장명, 근로자 이름, 소속을 모두 입력해주세요.");
      currentScore=0,currentSequenceIndex=0,hasCompletedFirstCycle=!1,isInRandomCycle=!1,gameSequence=[3,4,5,6,7],cycleCount=1;
      for(let e=3;e<=7;e++){const t=document.getElementById(`button-container-${e}`);t&&(t.innerHTML=`<button class="button" id="next-button-${e}" disabled>다음</button>`)}
      document.getElementById("current-score").textContent=currentScore,setChancesForCycle(),showScore(),showChances(),showPage("page3"),initializeGame(3),bindNextButtonEvents()
    });

    function bindNextButtonEvents(){document.querySelectorAll('[id^="next-button-"]').forEach(e=>e.replaceWith(e.cloneNode(!0))),document.getElementById("next-button-3").addEventListener("click",()=>goToNextPage()),document.getElementById("next-button-4").addEventListener("click",()=>goToNextPage()),document.getElementById("next-button-5").addEventListener("click",()=>goToNextPage()),document.getElementById("next-button-6").addEventListener("click",()=>goToNextPage()),document.getElementById("next-button-7").addEventListener("click",()=>goToNextPage())}
    function goToNextPage(){updateScore(),currentSequenceIndex++,currentSequenceIndex>=gameSequence.length?showCycleCompleteButtons(gameSequence[gameSequence.length-1]):(setChancesForCycle(),showPage(`page${gameSequence[currentSequenceIndex]}`),initializeGame(gameSequence[currentSequenceIndex]))}
    function checkGameComplete(e){pageGearData[e].filter(e=>e.correct).every(e=>e.applied)&&(document.getElementById(`next-button-${e}`).disabled=!1,currentSequenceIndex===gameSequence.length-1&&showCycleCompleteButtons(e))}
    function showCycleCompleteButtons(e){const t=document.getElementById(`button-container-${e}`);t&&(t.innerHTML='<button class="button" onclick="goToPage8()">다음</button><button class="restart-button" onclick="startNewRandomCycle()">다시 학습하기</button>')}
    function goToPage8(){hideScore(),hideChances(),document.getElementById("final-score").textContent=currentScore,document.getElementById("cert-siteName").innerText="현장명: "+document.getElementById("siteName").value,document.getElementById("cert-workerName").innerText="근로자 이름: "+document.getElementById("workerName").value,document.getElementById("cert-workerAffiliation").innerText="소속: "+document.getElementById("workerAffiliation").value,showPage("page8"),saveScoreAndLoadRanking()}
    function startNewRandomCycle(){cycleCount++,isInRandomCycle=!0,gameSequence=shuffle([3,4,5,6,7]),currentSequenceIndex=0;for(let e=3;e<=7;e++){const t=document.getElementById(`button-container-${e}`);t&&(t.innerHTML=`<button class="button" id="next-button-${e}" disabled>다음</button>`)}showPage(`page${gameSequence[0]}`),initializeGame(gameSequence[0]),bindNextButtonEvents()}
    document.getElementById("homeButton").addEventListener("click",()=>location.reload());
    function showPage(e){document.querySelectorAll(".page").forEach(e=>e.classList.remove("active")),document.getElementById(e).classList.add("active")}
    function shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}
    function initializeGame(e){pageGearData[e].forEach(e=>e.applied=!1);const t=shuffle([...pageGearData[e]]),n=document.getElementById(`gear-grid-${e}`);n.innerHTML="",0===currentSequenceIndex&&setChancesForCycle(),t.forEach(t=>{const r=document.createElement("div");r.className="gear-item";const a=document.createElement("img");a.src=t.thumbnail,a.classList.add("rounded-border"),a.dataset.id=t.id,a.style.pointerEvents="auto",a.style.opacity="1",a.style.cursor="pointer",a.addEventListener("click",()=>handleGearClick(t,a,e)),r.appendChild(a),n.appendChild(r)});const r=document.querySelector(`#page${e} .worker-container`);r.querySelectorAll(".overlay").forEach(e=>e.remove()),document.getElementById(`next-button-${e}`).disabled=!0,document.getElementById(`error-message-${e}`).innerText=""}
    function handleGearClick(e,t,n){if(cycleCount>1&&decreaseChances())return;e.correct?(e.applied?(t.style.opacity=1,e.applied=!1,removeOverlayImage(e,n)):(t.style.opacity=.5,e.applied=!0,addOverlayImage(e,n))):(document.getElementById(`error-message-${n}`).innerText="올바르지 않은 보호구입니다.",setTimeout(()=>{document.getElementById(`error-message-${n}`).innerText=""},2e3)),checkGameComplete(n)}
    function addOverlayImage(e,t){if(!e.overlay)return;const n=document.querySelector(`#page${t} .worker-container`),r=document.createElement("img");r.src=e.overlay,r.className="overlay",r.dataset.id=e.id,r.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;z-index:"+e.zIndex,n.appendChild(r)}
    function removeOverlayImage(e,t){const n=document.querySelector(`#page${t} .worker-container img.overlay[data-id="${e.id}"]`);n&&n.remove()}

    /* ---- 랭킹 저장·표시 (동일) ---- */
    async function saveScoreAndLoadRanking(){const e={name:document.getElementById("workerName").value,siteName:document.getElementById("siteName").value,affiliation:document.getElementById("workerAffiliation").value,score:currentScore,timestamp:new Date};try{db?(await saveToFirestore(e),await loadRankingFromFirestore()):(saveToLocalStorage(e),loadRankingFromLocalStorage())}catch(t){console.error("점수 저장 실패:",t),saveToLocalStorage(e),loadRankingFromLocalStorage()}}
    async function saveToFirestore(e){const t=getWeekIdKR(),n=db.collection("rankings").doc(t),r=await n.get();let a=[];r.exists&&(a=r.data().rankings||[]),a.push(e),a.sort((e,t)=>t.score-e.score),a.length>5&&(a=a.slice(0,5)),await n.set({rankings:a})}
    async function loadRankingFromFirestore(){const e=getWeekIdKR(),t=db.collection("rankings").doc(e),n=await t.get();displayRanking(n.exists?n.data().rankings||[]:[])}
    function saveToLocalStorage(e){const t=getWeekIdKR(),n=`rankings_${t}`;let r=JSON.parse(localStorage.getItem(n)||"[]");r.push(e),r.sort((e,t)=>t.score-e.score),r.length>5&&(r=r.slice(0,5)),localStorage.setItem(n,JSON.stringify(r))}
    function loadRankingFromLocalStorage(){const e=getWeekIdKR(),t=`rankings_${e}`,n=JSON.parse(localStorage.getItem(t)||"[]");displayRanking(n)}
    function getWeekIdKR(){const e=new Date,t=new Date(e.getTime()+324e5);t.setDate(t.getDate()-t.getDay()),t.setHours(0,0,0,0);const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${n}-${r}-${a}`}
    function displayRanking(e){document.getElementById("ranking-loading").style.display="none",document.getElementById("ranking-table").style.display="table";const t=document.getElementById("ranking-body");t.innerHTML="";for(let n=0;n<5;n++){const r=t.insertRow();if(n<e.length){const t=e[n];r.innerHTML=`<td>${n+1}</td><td>${t.name}</td><td>${t.siteName}</td><td>${t.affiliation}</td><td>${t.score}</td>`}else r.innerHTML=`<td>${n+1}</td><td>-</td><td>-</td><td>-</td><td>-</td>`}}
    /* ---- 수료증 저장 ---- */
    document.getElementById("saveCert").addEventListener("click",()=>{html2canvas(document.getElementById("certificate-box")).then(e=>{const t=document.createElement("a");t.download="certificate.png",t.href=e.toDataURL(),t.click()})});

    /* 초기 바인딩 */
    bindNextButtonEvents();
  </script>
</body>
</html>
